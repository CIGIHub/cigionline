{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags webpack_loader %}

{% block extra_css %}
  {% render_bundle 'themeLongform' 'css' %}
{% endblock %}

{% block body_class %}longform-article-series{% endblock %}

{% block header %}
  {% image self.image_banner original as image_hero %}
  <div class="longform-article-series-hero" style="background-image: url('{{ image_hero.url }}');">
    {% include "includes/top_bar.html" %}
    {% if self.video_banner %}
      <video playsinline autoplay muted loop class="video-background">
        <source src="{{ self.video_banner.url }}" type="video/mp4">
      </video>
    {% endif %}
    <div class="hero-content">
      <div class="container-lg">
        <h1>{{ self.title }}</h1>
        <p class="cigi-essay-series">A CIGI Essay Series</p>
        <p class="series-contributors-title">
          Series Contributors:
        </p>
        <p class="series-contributors">
          {% for block in self.series_items %}
            {% if block.block_type == 'series_item' %}
              {% if block.value.specific.authors %}
                {% for author in block.value.specific.authors %}
                  {% if author.block_type == 'author' %}
                    <span>{{ author.value.title }}</span>
                  {% endif %}
                {% endfor %}
              {% endif %}
            {% endif %}
          {% endfor %}
        </p>
        <div class="scroll-anchor">
          <a href="#article-body">
            <i class="far fa-angle-down"></i>
          </a>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block content %}
  <section class="body" id="article-body">
    <div class="container-lg">
      <h2 class="about-series"><span>About the Series</span></h2>
    </div>
    {% for block in self.body %}
      {% include_block block %}
    {% endfor %}
  </section>
  <section class="longform-article-series-in-the-series">
    <div class="container-lg">
      <h2><span>In the Series</span></h2>
      <div class="longform-article-series-in-the-series-items">
        {% for block in self.series_items %}
          {% if block.block_type == 'series_item' %}
            <article>
              <h4>
                <a href="{{ block.value.url }}">
                  {{ block.value.title }}
                </a>
              </h4>
              <p class="authors">
                Author{{ block.value.specific.authors|length|pluralize }}:
                {% for author in block.value.specific.authors %}
                  <span>
                    {% if author.block_type == 'author' %}
                      <a href="{{ author.value.url }}">
                        {{ author.value.title }}
                      </a>
                    {% elif author.block_type == 'external_author' %}
                      {{ author.value }}
                    {% endif %}
                  </span>
                {% endfor %}
              </p>
            </article>
          {% elif block.block_type == 'category_title' %}
            <h3>{{ block.value }}</h3>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </section>
{% endblock %}
