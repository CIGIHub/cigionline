{% extends "wagtailadmin/base.html" %}
{% load i18n %}
{% block titletag %}{% trans "Registration Reports" %}{% endblock %}

{% block content %}
  <header class="nice-padding registration-reports-header">
    <div class="row">
      <div class="left">
        <h1 class="icon icon-table title">{% trans "Registration-enabled Events" %}</h1>
        <p class="help-block title">{% trans "Only events with registration_open = True" %}</p>
      </div>
    </div>
  </header>

  <div class="nice-padding registration-reports-body">
    <form method="get" class="w-form w-mb-4" style="margin-bottom: 1rem;">
      <div class="field">
        <label class="w-sr-only" for="id_q">{% trans "Search" %}</label>
        <input
          type="search"
          name="q"
          id="id_q"
          placeholder="{% trans 'Search events' %}"
          value="{{ q|default:'' }}"
          style="max-width: 420px;"
        />
        <input type="hidden" name="sort" value="{{ sort }}" />
        <input type="hidden" name="dir" value="{{ dir }}" />
        <button type="submit" class="button">{% trans "Search" %}</button>
        {% if q %}
          <a class="button button-secondary" href="?sort={{ sort }}&dir={{ dir }}">{% trans "Clear" %}</a>
        {% endif %}
      </div>
    </form>

    <table class="listing">
      <thead>
        <tr>
          <th>{% trans "Event" %}</th>
          <th class="w-min">
            {% with next_dir="asc" %}
              {% if sort == "publishing_date" and dir == "asc" %}{% with next_dir="desc" %}{% endwith %}{% endif %}
            {% endwith %}
            <a href="?sort=publishing_date&dir={% if sort == 'publishing_date' and dir == 'desc' %}asc{% else %}desc{% endif %}">
              {% trans "Publishing date" %}
              {% if sort == 'publishing_date' %}
                {% if dir == 'asc' %}▲{% else %}▼{% endif %}
              {% endif %}
            </a>
          </th>
          <th class="w-min">
            <a href="?sort=last_published_at&dir={% if sort == 'last_published_at' and dir == 'desc' %}asc{% else %}desc{% endif %}">
              {% trans "Last published" %}
              {% if sort == 'last_published_at' %}
                {% if dir == 'asc' %}▲{% else %}▼{% endif %}
              {% endif %}
            </a>
          </th>
          <th class="w-min">{% trans "Types" %}</th>
          <th class="w-min">{% trans "Confirmed (total)" %}</th>
          <th class="w-min">{% trans "View" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
          <tr>
            <td class="title">
              <div class="title-wrapper">
                <a class="title-link" href="{% url detail_url_name pk=row.event.pk %}">
                  {{ row.event.title }}
                </a>
              </div>
              <div class="buttons">
                <a href="{{ row.event.url }}" class="button button-secondary" rel="noopener">View Event</a>
                <a href="/admin/pages/{{ row.event.pk }}/edit/" class="button button-secondary">Edit Event</a>
              </div>
            </td>
            <td class="w-min">
              {% if row.publishing_date %}{{ row.publishing_date|date:"Y-m-d" }}{% else %}—{% endif %}
            </td>
            <td class="w-min">
              {% if row.last_published_at %}{{ row.last_published_at|date:"Y-m-d" }}{% else %}—{% endif %}
            </td>
            <td class="w-min">{{ row.type_count }}</td>
            <td class="w-min">{{ row.confirmed_total }}</td>
            <td class="w-min column-view">
              <a href="{% url detail_url_name pk=row.event.pk %}" class="button bicolor button-small">
                Details
              </a>
            </td>
          </tr>
        {% empty %}
          <tr><td colspan="6">{% trans "No events with registration enabled." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
